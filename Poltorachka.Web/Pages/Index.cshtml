@page
@using Microsoft.AspNetCore.Identity
@using Poltorachka.Pages
@using Poltorachka.Web
@using Poltorachka.Web.Models
@using Poltorachka.Web.Pages
@inject UserManager<ApplicationUser> UserManager

@model Poltorachka.Web.Pages.IndexModel
@{
    ViewData["Title"] = "Полторачка";
}

<table class="table">
    <thead>
    <tr>
        <th>
            Когда
        </th>
        <th>
            Кто
        </th>
        <th>
            Кому
        </th>
        <th>
            Оформил
        </th>
        <th>
            Свидетельствовал
        </th>
        <th>
            Сколько
        </th>
        <th>
            Статус
        </th>
    </tr>
    </thead>
    <tbody>
    @foreach (var fact in Model.Facts)
    {
        <tr>
            <td>@fact.Date.ToShortDateString() 
                @if ((DateTime.UtcNow - fact.Date).TotalMilliseconds < TimeSpan.FromDays(1).TotalMilliseconds)
                {
                    <span class="label label-info">New</span>
                }
            </td>
            <td>@fact.LoserName</td>
            <td>@fact.WinnerName
                @switch (fact.Score)
                {
                    case byte score when (score == 2):
                        <span class="label label-success">2x combo</span>
                        break;
                    case byte score when (score == 3):
                        <span class="label label-success">3x combo</span>
                        break;
                    case byte score when (score >= 4 && score <= 5):
                        <span class="label label-warning">headshot</span>
                        break;
                    case byte score when (score >= 5):
                        <span class="label label-danger">unstoppable</span>
                        break;
                }
            </td>
            <td>@fact.CreatorName</td>
            <td>@fact.WitnessName</td>
            <td>@fact.Score
            </td>
            <td>
                @if (User.IsInRole(Roles.CreateAndEditFacts) && fact.Status == FactStatusViewModel.Pending)
                {
                    <a asp-page="./Facts/FactEdit" asp-route-factId="@fact.FactId">@fact.Status.ToString()</a>
                }
                else
                {
                    @fact.Status.ToString()
                }
            </td>
        </tr>
    }
    </tbody>
</table>
@if (User.IsInRole(Roles.CreateAndEditFacts))
{
    <div>
        <a asp-page="./Facts/CreateFact" class="btn btn-primary">Создать предъяву</a>
    </div>
}
